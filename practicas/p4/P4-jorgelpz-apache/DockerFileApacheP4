FROM jorgelpz-apache-image:p3

RUN apt-get update && apt-get install -y iptables
# es necesario pasar los archivos de la p3 porque antes lo hacía
# en el docker-compose y ahora los cargo en la imagen

# además se incluyen los nuevos archivos para iptables y entrypoint
COPY ./P4-jorgelpz-certificados/certificado_jorgelpz.crt /etc/apache2/ssl/certificado_jorgelpz.crt 
COPY ./P4-jorgelpz-certificados/certificado_jorgelpz.key /etc/apache2/ssl/certificado_jorgelpz.key
COPY ./P4-jorgelpz-apache/jorgelpz-apache-ssl.conf /etc/apache2/sites-available/jorgelpz-apache-ssl.conf
COPY ./P4-jorgelpz-apache/P4-jorgelpz-iptables-web/jorgelpz-iptables-web.sh /jorgelpz-iptables-web.sh
COPY ./P4-jorgelpz-apache/P4-jorgelpz-iptables-web/entrypoint.sh /entrypoint.sh
# asignamos permisos
RUN chmod 600 /etc/apache2/ssl/certificado_jorgelpz.crt
RUN chmod +x /entrypoint.sh /jorgelpz-iptables-web.sh
# configuramos entrypoint.sh como verdadero entrypoint
ENTRYPOINT [ "/entrypoint.sh" ]

CMD ["apachectl", "-D", "FOREGROUND"]


